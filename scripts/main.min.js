"use strict";const customVideo=document.querySelector(".custom-video"),video=customVideo.querySelector(".custom-video__elements"),buttonStart=customVideo.querySelector(".custom-video__start"),buttonPlayPause=customVideo.querySelector(".custom-video__play-pause"),rangeTime=customVideo.querySelector(".custom-video__range-elements"),timeBefore=customVideo.querySelector(".custom-video__range-before"),timeAfter=customVideo.querySelector(".custom-video__range-after"),fullscreen=customVideo.querySelector(".custom-video__fullscreen"),buttonSound=customVideo.querySelector(".custom-video__sound-button"),rangeSound=customVideo.querySelector(".custom-video__sound-range"),soundDownload=customVideo.querySelector(".custom-video__download"),buttonCC=customVideo.querySelector(".custom-video__button-cc"),labelSpeed=customVideo.querySelector(".custom-video__speed-label span"),rangeSpeed=customVideo.querySelector(".custom-video__speed-range"),buttonSettings=customVideo.querySelector(".custom-video__settings");video.controls=!1,video.muted&&buttonSound.classList.add("custom-video__sound-button--muted");const setDuration=()=>{rangeTime.setAttribute("max",video.duration),timeAfter.innerText=secondsToTime(0),timeBefore.innerText=secondsToTime(video.duration)},handleLoadedMetaData=()=>{setDuration()};video.addEventListener("loadedmetadata",handleLoadedMetaData);const handleButtonStart=()=>{buttonStart.removeEventListener("click",handleButtonStart),buttonStart.classList.add("hidden"),toggleMuted()},toggleButtonPlayPause=()=>{buttonPlayPause.classList.toggle("custom-video__play-pause--played")};video.muted&&video.autoplay&&buttonStart&&(buttonStart.classList.remove("hidden"),buttonStart.addEventListener("click",handleButtonStart),toggleButtonPlayPause(),buttonSound.classList.add("custom-video__sound-button--muted"));const handleButtonPlayPause=()=>{video.paused||video.ended?(video.duration-video.currentTime<=10&&(video.currentTime=0),video.play(),toggleButtonPlayPause()):(video.pause(),buttonPlayPause.classList.remove("custom-video__play-pause--played"))};buttonPlayPause.addEventListener("click",handleButtonPlayPause);const secondsToTime=e=>new Date(1e3*e).toISOString().slice(11,19),handleTimeUpdate=()=>{rangeTime.getAttribute("max")||setDuration(),rangeTime.value=video.currentTime,timeAfter.innerText=secondsToTime(video.currentTime)};video.addEventListener("timeupdate",handleTimeUpdate);const handleEnded=()=>{buttonPlayPause.classList.remove("custom-video__play-pause--played")};video.addEventListener("ended",handleEnded);const handleRangeTime=()=>{video.currentTime=+rangeTime.value};rangeTime.addEventListener("input",handleRangeTime);const toggleMuted=()=>{buttonSound.classList.toggle("custom-video__sound-button--muted"),video.muted=!video.muted},handleButtonSound=()=>{0!==video.volume&&toggleMuted()};buttonSound.addEventListener("click",handleButtonSound);const handleRangeSound=()=>{video.volume=rangeSound.value,buttonSound.classList.toggle("custom-video__sound-button--down",+rangeSound.value<=.5),buttonSound.classList.toggle("custom-video__sound-button--muted",0==+rangeSound.value),video.muted=!video.volume};rangeSound.addEventListener("input",handleRangeSound);const toggleFullscreenClass=()=>{customVideo.classList.toggle("custom-video--fullscreen")},handleFullscreenchange=()=>{null===document.fullscreenElement&&(toggleFullscreenClass(),customVideo.removeEventListener("fullscreenchange",handleFullscreenchange))},handleFullscreen=()=>{null===document.fullscreenElement?(customVideo.addEventListener("fullscreenchange",handleFullscreenchange),customVideo.requestFullscreen()):(customVideo.removeEventListener("fullscreenchange",handleFullscreenchange),document.exitFullscreen()),toggleFullscreenClass()};fullscreen.addEventListener("click",handleFullscreen);const handleRangeSpeed=()=>{video.playbackRate=+rangeSpeed.value,labelSpeed.innerText=+rangeSpeed.value};rangeSpeed.addEventListener("input",handleRangeSpeed);const checkSettingsClick=e=>{e.target.closest(".custom-video__settings")||e.target.closest(".custom-video__list-settings")||closeSetting()},openSetting=()=>{buttonSettings.classList.add("custom-video__settings--opened"),document.addEventListener("click",checkSettingsClick)},closeSetting=()=>{buttonSettings.classList.remove("custom-video__settings--opened"),document.removeEventListener("click",checkSettingsClick)},handleButtonSettings=()=>{if(buttonSettings.classList.contains("custom-video__settings--opened"))return closeSetting();buttonSettings.classList.add("custom-video__settings--opened"),document.addEventListener("click",checkSettingsClick)};buttonSettings.addEventListener("click",handleButtonSettings);const toggleButtonCCClassHidden=()=>{buttonCC.classList.toggle("hidden")};if(0===video.textTracks.length)toggleButtonCCClassHidden();else for(var i=0;i<video.textTracks.length;i++)video.textTracks[i].mode="hidden";const handleButtonCC=()=>{"hidden"===video.textTracks[0].mode?(video.textTracks[0].mode="showing",buttonCC.classList.toggle("custom-video__button-cc--current")):(buttonCC.classList.toggle("custom-video__button-cc--current"),video.textTracks[0].mode="hidden")};1===video.textTracks.length&&buttonCC.addEventListener("click",handleButtonCC);const toggleButtonCCClassCurrent=(e,t)=>{e.forEach(e=>{e.classList.toggle("custom-video__button-cc--current",+e.dataset.track==+t)})},createButtonCC=(e,t)=>{const o=document.createElement("button");return o.type="button",o.innerText=e,o.classList.add("custom-video__button-settings"),o.classList.add("custom-video__button-cc"),o.dataset.track=t,o};if(video.textTracks.length>1){toggleButtonCCClassHidden();const e=[],t=document.createElement("ul");t.classList.add("custom-video__list-cc");const o=document.createElement("li"),n=createButtonCC("Отключить",-1);e.push(n),toggleButtonCCClassCurrent(e,-1),o.append(n),t.append(o);for(let o=0;o<video.textTracks.length;o++){const n=video.textTracks[o],s=document.createElement("li"),d=createButtonCC(n.label,o);e.push(d),s.append(d),t.append(s)}buttonCC.after(t),t.addEventListener("click",t=>{if(!t.target.dataset.track)return;const o=t.target.dataset.track;for(var n=0;n<video.textTracks.length;n++)video.textTracks[n].mode="hidden";toggleButtonCCClassCurrent(e,o),"-1"!==o&&(video.textTracks[o].mode="showing")})}